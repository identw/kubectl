name: Tag kubectl version

on:
  pull_request:
    types: [closed]

jobs:
  tag-kubectl:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
      - name: Check if PR is from renovate and touches Dockerfile
        # if: contains(github.event.pull_request.head.ref, 'renovate') && github.event.pull_request.changed_files > 0
        uses: actions/checkout@main

      - name: Extract kubectl version from PR diff
        id: parse
        run: |
          echo '${{ toJSON(github.event.pull_request) }}'

          # VERSION=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          #   "${{ github.event.pull_request.diff_url }}" \
          #   | grep -Eo 'https://dl.k8s.io/release/v[0-9]+\.[0-9]+\.[0-9]+' \
          #   | head -1 | sed 's|.*/v||')

          # echo "Extracted kubectl version: $VERSION"
          # echo "version=$VERSION" >> $GITHUB_OUTPUT

      # - name: Create tag
      #   if: steps.parse.outputs.version != ''
      #   run: |
      #     git fetch --unshallow
      #     git tag "kubectl-v${{ steps.parse.outputs.version }}"
      #     git push origin "kubectl-v${{ steps.parse.outputs.version }}"
